
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Annotate Data &#8212; cellxgene 1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section class="tex2jax_ignore mathjax_ignore" id="annotate-data">
<h1>Annotate Data<a class="headerlink" href="#annotate-data" title="Permalink to this headline">¶</a></h1>
<section id="creating-annotations-in-cellxgene">
<h2>Creating annotations in cellxgene<a class="headerlink" href="#creating-annotations-in-cellxgene" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="#"><span class="doc std std-doc">Cellxgene Desktop</span></a> enables users to create and edit categorical annotations within the app. This is commonly used to annotate cell types of data being analyzed for the first time.</p>
</section>
<section id="data-lifecycle-for-annotations">
<h2>Data lifecycle for annotations<a class="headerlink" href="#data-lifecycle-for-annotations" title="Permalink to this headline">¶</a></h2>
<section id="creating-annotations-quickstart">
<h3>1. Creating annotations (quickstart)<a class="headerlink" href="#creating-annotations-quickstart" title="Permalink to this headline">¶</a></h3>
<p>To get started, run:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cellxgene launch mydata.h5ad
</pre></div>
</div>
<p>To preserve data provenance, <strong><code class="docutils literal notranslate"><span class="pre">cellxgene</span></code> does not alter the input h5ad file</strong>. Rather, newly-created annotations are saved in a specified CSV file:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>annotations-directory/name-########.csv
</pre></div>
</div>
<ul class="simple">
<li><p>The default <code class="docutils literal notranslate"><span class="pre">annotations-directory</span></code> is your current working directory (i.e., the directory you were in when you started cellxgene)</p></li>
<li><p>You will be prompted to enter a name for your annotations the first time you create a new category</p></li>
<li><p>We also assign a unique identifier in the form of an 8-character suffix, <code class="docutils literal notranslate"><span class="pre">########</span></code>; this helps cellxgene identify your file to avoid overwriting your work</p></li>
</ul>
</section>
<section id="loading-editing-and-updating-existing-draft-annotations">
<h3>2. Loading, editing and updating existing draft annotations<a class="headerlink" href="#loading-editing-and-updating-existing-draft-annotations" title="Permalink to this headline">¶</a></h3>
<p>Cellxgene allows you to load and edit compatible draft annotations across multiple sessions.</p>
<p>Compatible annotations are tabular, with category names as column headers; <code class="docutils literal notranslate"><span class="pre">anndata.obs.index</span></code> as the index; and categorical values (i.e., fewer unique values per column than specified in <code class="docutils literal notranslate"><span class="pre">--max-category-items</span></code>, default 1000).</p>
<p>There are two options for updating draft annotations.</p>
<section id="autodetect-annotations-csv">
<h4>Autodetect annotations CSV<a class="headerlink" href="#autodetect-annotations-csv" title="Permalink to this headline">¶</a></h4>
<p>Cellxgene will automatically find and reload your draft annotations in editable mode. This assumes that:</p>
<p>1 - The h5ad filename is the same<br />
2 - You launch cellxgene from the <code class="docutils literal notranslate"><span class="pre">annotations-directory</span></code> (i.e., the directory that contains your CSV)<br />
3 - You use the same browser and have not cleared your cookies (we use a small cookie to keep track of which user created the file to avoid accidental overwrites; see FAQ)</p>
</section>
<section id="specify-an-annotations-csv">
<h4>Specify an annotations CSV<a class="headerlink" href="#specify-an-annotations-csv" title="Permalink to this headline">¶</a></h4>
<p><strong>This mode is only appropriate for single-user, local cellxgene instances.</strong></p>
<p>If you’d like to specify the complete file path for your annotations, you can do so by running:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cellxgene launch mydata.h5ad --annotations-file path/to/myfile.csv
</pre></div>
</div>
<p>Any changes you make will be reflected in the original CSV. If the file does not exist, it will be created.<br />
<strong>Please note that this file will be overwritten, making this mode inappropriate for hosted / multi-user settings (see below).</strong></p>
</section>
<section id="merging-draft-annotations-with-the-main-h5ad-file">
<h4>3. Merging draft annotations with the main h5ad file<a class="headerlink" href="#merging-draft-annotations-with-the-main-h5ad-file" title="Permalink to this headline">¶</a></h4>
<p>Once you’re finished with your annotations, you should finalize and preserve your work by merging your <code class="docutils literal notranslate"><span class="pre">csv</span></code> into your main <code class="docutils literal notranslate"><span class="pre">h5ad</span></code> file.</p>
<p>You can do so like this:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>import pandas as pd
import scanpy as sc

new_annotations = pd.read_csv(&#39;myannotations.csv&#39;,
                         comment=&#39;#&#39;,
                         dtype=&#39;category&#39;,
                         index_col=0)
anndata = sc.read(&#39;mydata.h5ad&#39;)
anndata.obs = anndata.obs.join(new_annotations)
</pre></div>
</div>
</section>
</section>
</section>
<section id="annotations-by-multiple-users">
<h2>Annotations by multiple users<a class="headerlink" href="#annotations-by-multiple-users" title="Permalink to this headline">¶</a></h2>
<p>As described in the <span class="xref myst">hosted</span> section, we do not officially support hosted or multi-user use of cellxgene. However, we recognize that the app is often adapted for this purpose, and have tried to provide a “safe path” for multi-user setups that avoids overwriting data.</p>
<p>Specifying a single file name for multiple contributors will result in data overwriting. To avoid this, you can instead specify an output directory and allow cellxgene to assign filenames.</p>
<p>To specify an output directory, run:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cellxgene launch mydata.h5ad --annotations-dir path/to/annotations-directory/
</pre></div>
</div>
<p>For each user, annotations will be saved as follows:</p>
<ul class="simple">
<li><p>Each user will be prompted to enter a name for their annotations the first time they create a new category</p></li>
<li><p>We also assign a unique identifier in the form of an 8-character suffix, <code class="docutils literal notranslate"><span class="pre">########</span></code>; this helps cellxgene identify their specific file to avoid overwriting others’ work</p></li>
<li><p>Any annotations created in the application will be autosaved in <code class="docutils literal notranslate"><span class="pre">annotations-directory/name-########.csv</span></code></p></li>
</ul>
<section id="faq">
<h3>FAQ<a class="headerlink" href="#faq" title="Permalink to this headline">¶</a></h3>
<section id="how-do-i-know-my-annotations-are-saved">
<h4>How do I know my annotations are saved?<a class="headerlink" href="#how-do-i-know-my-annotations-are-saved" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">cellxgene</span></code> autosaves any changes made to your annotations every 3 seconds.</p>
</section>
<section id="i-think-i-deleted-my-annotations-can-they-be-recovered">
<h4>I think I deleted my annotations! Can they be recovered?<a class="headerlink" href="#i-think-i-deleted-my-annotations-can-they-be-recovered" title="Permalink to this headline">¶</a></h4>
<p>Not to worry! We save the last 10 versions of your annotations in <code class="docutils literal notranslate"><span class="pre">annotations-directory/NAME-backups/</span></code></p>
</section>
<section id="what-about-creating-continuous-annotations">
<h4>What about creating continuous annotations?<a class="headerlink" href="#what-about-creating-continuous-annotations" title="Permalink to this headline">¶</a></h4>
<p>Continuous metadata is important! However, these values (e.g., pseudotime) are the result of statistical analyses that are beyond cellxgene’s visualization and exploration focused scope. We do, of course, provide visualization of continuous metadata values computed elsewhere and stored in <code class="docutils literal notranslate"><span class="pre">anndata.obs</span></code>.</p>
</section>
<section id="i-keep-getting-weird-index-errors-when-trying-to-join-my-annotations-to-my-anndata">
<h4>I keep getting weird index errors when trying to join my annotations to my anndata?<a class="headerlink" href="#i-keep-getting-weird-index-errors-when-trying-to-join-my-annotations-to-my-anndata" title="Permalink to this headline">¶</a></h4>
<p>This is most likely because the h5ad file you are working with is not the original file used to generate the annotations! We recommend merging new annotations in on a regular basis for this reason.</p>
</section>
<section id="how-do-you-remember-my-unique-id-to-match-my-cellxgene-session-with-my-annotations-file">
<h4>How do you remember my unique ID to match my cellxgene session with my annotations file?<a class="headerlink" href="#how-do-you-remember-my-unique-id-to-match-my-cellxgene-session-with-my-annotations-file" title="Permalink to this headline">¶</a></h4>
<p>We place a small cookie (file) in your browser that identifies where your draft annotations are saved. This file never leaves your machine, and is never sent to the cellxgene team or anyone else.</p>
</section>
<section id="i-have-feedback-and-ideas-for-you">
<h4>I have feedback and ideas for you!<a class="headerlink" href="#i-have-feedback-and-ideas-for-you" title="Permalink to this headline">¶</a></h4>
<p>Wonderful! We would <em>love</em> to <a class="reference internal" href="../contact-us.html"><span class="doc std std-doc">hear your feedback</span></a> :)</p>
</section>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">cellxgene</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../annotating-data.html">Annotating Data</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, cellxgene@chanzuckerberg.com.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/desktop/annotations.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>